@using TaskBoard.Web.ViewModels
@model TaskListViewModel
@{
    ViewData["Title"] = "Tasks";
}

<h1 class="h4 mb-4">Tasks</h1>

@if (TempData["Error"] is string e1)
{
    <div class="alert alert-danger">@e1</div>
}
@if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}

<form asp-action="Create" method="post" class="mb-3">
    @Html.AntiForgeryToken()
    <div class="input-group">
        <input asp-for="NewTitle" class="form-control" placeholder="Add a task..." maxlength="200" required />
        <button class="btn btn-primary" type="submit">Add</button>
    </div>
</form>

@if (Model.Items.Count == 0)
{
    <div class="text-muted">No tasks yet. Add your first one!</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th style="width:3rem;"></th>
                    <th>Title</th>
                    <th style="width:12rem;">Created (UTC)</th>
                    <th style="width:7rem;"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var t in Model.Items)
                {
                    <tr>
                        <td>
                            <form asp-action="Toggle" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@t.Id" />
                                <input type="hidden" name="isDone" value="@(!t.IsDone)" />
                                <input class="form-check-input" type="checkbox" onchange="this.form.submit()" @(t.IsDone ? "checked" : "") />
                            </form>
                        </td>
                        <td class="@(t.IsDone ? "text-decoration-line-through text-muted" : "")">@t.Title</td>
                        <td>@t.CreatedUtc.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>
                            <form asp-action="Delete" method="post" class="d-inline" onsubmit="return confirm('Delete this task?');">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@t.Id" />
                                <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
